<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <title>Professioneel Dartspel</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #1b1b1b;
            color: #f5f5f5;
            text-align: center;
            margin: 20px;
        }
        canvas {
            background-color: #000;
            border-radius: 50%;
            border: 2px solid #fff;
            margin-top: 20px;
        }
        button, select {
            padding: 10px 20px;
            margin: 10px;
            font-size: 16px;
            border-radius: 8px;
            border: none;
            background-color: #444;
            color: #fff;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <h1>Professioneel Dartspel - 501</h1>
    <div>
        <label for="players">Aantal spelers: </label>
        <select id="players">
            <option value="1">1</option>
            <option value="2" selected>2</option>
            <option value="3">3</option>
            <option value="4">4</option>
        </select>
        <button onclick="startGame()">Start spel</button>
    </div>

    <div id="scoreboard" style="display:none;">
        <h2>Beurt: <span id="currentPlayer">Speler 1</span></h2>
        <div id="scores"></div>
        <p>Laatste worp: <span id="lastThrow">-</span></p>
        <p>Pijlen resterend: <span id="dartsLeft">3</span></p>
    </div>

    <canvas id="dartboard" width="500" height="500" style="display:none;"></canvas>

    <script>
        const sectors = [20, 1, 18, 4, 13, 6, 10, 15, 2, 17, 3, 19, 7, 16, 8, 11, 14, 9, 12, 5];
        let numPlayers = 2;
        let scores = [];
        let currentPlayer = 0;
        let gameActive = false;
        let dartsLeft = 3;
        const missChance = 5; // pixels afwijking max
        
        const canvas = document.getElementById("dartboard");
        const ctx = canvas.getContext("2d");

        function startGame() {
            numPlayers = parseInt(document.getElementById("players").value);
            scores = Array(numPlayers).fill(501);
            currentPlayer = 0;
            dartsLeft = 3;
            gameActive = true;
            document.getElementById("scoreboard").style.display = "block";
            document.getElementById("dartboard").style.display = "block";
            drawBoard();
            updateScores();
        }

        function updateScores() {
            document.getElementById("currentPlayer").innerText = "Speler " + (currentPlayer + 1);
            let html = "";
            scores.forEach((s, i) => {
                html += `<p>Speler ${i+1} score: ${s}</p>`;
            });
            document.getElementById("scores").innerHTML = html;
            document.getElementById("dartsLeft").innerText = dartsLeft;
        }

        function drawBoard() {
            ctx.clearRect(0, 0, 500, 500);
            const centerX = 250, centerY = 250;
            
            for (let i = 0; i < 20; i++) {
                let start = (i * 18 - 9) * Math.PI/180;
                let end = ((i+1) * 18 - 9) * Math.PI/180;
                
                // buitenste dubbel ring
                ctx.beginPath();
                ctx.moveTo(centerX, centerY);
                ctx.arc(centerX, centerY, 250, start, end);
                ctx.arc(centerX, centerY, 230, end, start, true);
                ctx.closePath();
                ctx.fillStyle = i % 2 === 0 ? "#ff0000" : "#008000";
                ctx.fill();
                
                // single buiten
                ctx.beginPath();
                ctx.moveTo(centerX, centerY);
                ctx.arc(centerX, centerY, 230, start, end);
                ctx.arc(centerX, centerY, 170, end, start, true);
                ctx.closePath();
                ctx.fillStyle = i % 2 === 0 ? "#fff" : "#000";
                ctx.fill();
                
                // triple ring
                ctx.beginPath();
                ctx.moveTo(centerX, centerY);
                ctx.arc(centerX, centerY, 170, start, end);
                ctx.arc(centerX, centerY, 150, end, start, true);
                ctx.closePath();
                ctx.fillStyle = i % 2 === 0 ? "#ff0000" : "#008000";
                ctx.fill();
                
                // single binnen
                ctx.beginPath();
                ctx.moveTo(centerX, centerY);
                ctx.arc(centerX, centerY, 150, start, end);
                ctx.arc(centerX, centerY, 25, end, start, true);
                ctx.closePath();
                ctx.fillStyle = i % 2 === 0 ? "#fff" : "#000";
                ctx.fill();
            }

            ctx.beginPath();
            ctx.arc(centerX, centerY, 25, 0, 2 * Math.PI);
            ctx.fillStyle = "#008000";
            ctx.fill();

            ctx.beginPath();
            ctx.arc(centerX, centerY, 10, 0, 2 * Math.PI);
            ctx.fillStyle = "#ff0000";
            ctx.fill();
        }

        canvas.addEventListener("click", function(e) {
            if (!gameActive) return;
            const rect = canvas.getBoundingClientRect();
            let x = e.clientX - rect.left - 250;
            let y = e.clientY - rect.top - 250;

            // Miss chance afwijking
            x += (Math.random() * 2 - 1) * missChance;
            y += (Math.random() * 2 - 1) * missChance;
            animateThrow(x, y);
        });

        function animateThrow(x, y) {
            let frames = 20;
            let currentFrame = 0;
            const interval = setInterval(() => {
                drawBoard();
                const fx = (x/frames) * currentFrame + 250;
                const fy = (y/frames) * currentFrame + 250;
                ctx.beginPath();
                ctx.arc(fx, fy, 5, 0, 2*Math.PI);
                ctx.fillStyle = "yellow";
                ctx.fill();
                currentFrame++;
                if (currentFrame > frames) {
                    clearInterval(interval);
                    calculateScore(x, y);
                }
            }, 20);
        }

        function calculateScore(x, y) {
            const distance = Math.sqrt(x*x + y*y);
            let angle = Math.atan2(-y, x) * 180 / Math.PI;
            if (angle < 0) angle += 360;
            let sectorIndex = Math.floor((angle + 9) / 18) % 20;
            let baseScore = sectors[sectorIndex];
            let multiplier = 1;

            if (distance <= 10) { baseScore = 50; multiplier = 1; }
            else if (distance <= 25) { baseScore = 25; multiplier = 1; }
            else if (distance >= 230) multiplier = 2;
            else if (distance >= 170 && distance <= 190) multiplier = 3;

            let throwScore = baseScore * multiplier;
            document.getElementById("lastThrow").innerText = `${baseScore} x${multiplier} = ${throwScore}`;

            let newScore = scores[currentPlayer] - throwScore;
            if (newScore < 0) {
                alert("Bust! Beurt voorbij.");
                endTurn();
            } else if (newScore === 0) {
                if (multiplier === 2 || baseScore === 50) {
                    alert("Speler " + (currentPlayer + 1) + " wint!");
                    gameActive = false;
                } else {
                    alert("Je moet uitgooien op een dubbel!");
                    endTurn();
                }
            } else {
                scores[currentPlayer] = newScore;
                dartsLeft--;
                if (dartsLeft === 0) {
                    endTurn();
                }
            }
            updateScores();
        }

        function endTurn() {
            dartsLeft = 3;
            currentPlayer = (currentPlayer + 1) % numPlayers;
            updateScores();
        }
    </script>
</body>
</html>
